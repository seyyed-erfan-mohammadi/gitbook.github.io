---
icon: '2'
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: false
  pagination:
    visible: true
---

# Head Position

Detecting head movements can be done by attaching a small set of coils, called cHPI coils, to specific locations of the participant's head before MEG recording begins (usually three to five coils).

### MEGIN Systems

This process relies on three key commands from the MNE library. The first, [`compute_chpi_amplitudes`](https://mne.tools/stable/generated/mne.chpi.compute_chpi_amplitudes.html), extracts the amplitude of waves generated by the cHPI coils at each sensor. Next, [`compute_chpi_locs`](https://mne.tools/stable/generated/mne.chpi.compute_chpi_locs.html) calculates the position of each coil during recording, using their initial positions obtained with a Digitizer before the session. Finally, [`compute_head_pos`](https://mne.tools/stable/generated/mne.chpi.compute_head_pos.html) integrates data from all coils to compute the headâ€™s position over time. The resulting head position data is saved and used in the temporal Signal Space Separation (tSSS) stage to correct for head movements.

Parameters for this step can be adjusted in the `pipeline_config.cfg`:

```json
"head_position": {
    "amplitudes": {
        "t_step_min": 0.25,
        "t_window": "auto",
        "ext_order": 1,
        "tmin": 0,
        "tmax": null
    },
    "locs": {
        "t_step_max": 3,
        "too_close": "raise",
        "adjust_dig": false
    },
    "head_pos": {
        "dist_limit": 0.005,
        "gof_limit": 0.98,
        "adjust_dig": false
    }
```

{% hint style="info" %}
The step size balances accuracy and speed in amplitude estimation. Elekta recommends a 10-millisecond step, but it slows down calculations, especially for long sessions like resting-state data, with minimal impact on accuracy. This is because participants typically remain relaxed, leading to minimal head movement during MEG recordings.
{% endhint %}

### CTF Systems

The [`extract_chpi_locs_ctf`](https://mne.tools/stable/generated/mne.chpi.extract_chpi_locs_ctf.html) function is used to retrieve head position information from CTF data. In CTF systems, the x, y, and z coordinates (in meters) of each cHPI coil are stored as individual channels within the dataset.

{% hint style="info" %}
MEGAP automatically checks whether cHPI data is present and identifies the type of MEG system being used. Based on this information, it then selects the appropriate method to extract head position data, ensuring compatibility with both MEGIN and CTF systems.
{% endhint %}
